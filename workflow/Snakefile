import json
import logging
from snakemake.utils import min_version

# ==== RUN ME through sbatch batchslurm.sh ====
# a version w cluster config is not yet available (may solve some of the issues w env)
min_version("8.11")

logging.basicConfig(
    filename="workflow.log",
    level=logging.INFO,
    format="%(asctime)s - %(levelname)s - %(message)s",
)


# include: "rules/test_sh.smk"

# from scripts.optimise import main

# ### A simple test for the run option


# rule solve_test:
#     input:
#         constraints="data/constraints.json",
#         license_file="/p/projects/rd3mod/gurobi_rc/gurobi.lic",
#     output:
#         "data/solution_test_run.json",
#     threads: 1
#     log:
#         "logs/optimize.log",
#     run:
#         main(
#             input.license_file,
#             input.constraints,
#             output[0],
#         )


rule log_test:
    log:
        "logs/test.log",
    script:
        "scripts/test_log.py"


# ===== THE GUROBI PROBLEM TO SOLVE =====
rule solve:
    input:
        constraints="data/constraints.json",
        license_file="/p/projects/rd3mod/gurobi_rc/gurobi.lic",
    output:
        "data/solution.json",
    threads: 1
    log:
        "logs/optimize.log",
    script:
        "scripts/optimise.py"
