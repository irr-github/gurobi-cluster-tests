import json
import logging
from snakemake.utils import min_version

# ==== RUN ME through sbatch batchslurm.sh ====
# a version w cluster config is not yet available (may solve some of the issues w env)
min_version("8.11")

# NOTE: do not set logging config here, use _helpers.configure_logging in each script main

# NOTE if the rules aren't chained only the first rule will be executed


# by default, only the first rule is executed (unless default_target is specified)
rule io_test:
    input:
        "results/solution_test_run.json",
    default_target: True
    output:
        "results/io_output.txt",
    # params:
    shell:
        """
        echo "input file was {input}" >> {output}
        echo "$(date +"%Y-%m-%d") $(date +"%H:%M:%S")" >> {output}
        echo "Current hostname: $(hostname)" >> {output}
        """


rule solve:
    input:
        constraints="data/constraints.json",
        license_file="/p/projects/rd3mod/gurobi_rc/gurobi.lic",
    output:
        "results/solution_test_run.json",
    threads: 1
    log:
        "logs/optimize.log",
    script:
        "scripts/optimise.py"
